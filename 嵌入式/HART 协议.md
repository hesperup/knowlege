## 一、概述

HART （Highway Addressable Remote Transducer）协议采用基于 Bell202 标准的 FSK频 移键控信号，在低频的 4-20mA模拟信号上叠加幅度为 0.5mA的音频数字信号进行双向数字通讯，数据传输率为1200bps。由于 FSK信号的平均值为0，不影响传送给控制系统模拟信号的大小，保证了与现有模拟系统的兼容性。在 HART 协议通信中主要的变量和控制信息由4-20mA传送，在需要的情况下，另外的测量、过程参数、设备组态、校准、诊断信息通过HART协议访问。

在应用层，HART规定了一系列命令，按命令方式工作。它有三类命令，第一类称为通用命令，这是所有设备都理解、执行的命令；第二类称为普通应用命令，所提供的功能可以在许多现场设备（尽管不是全部）中实现；第三类称为设备专用命令，以便于工作在某些设备中实现特殊功能，这类命令既可以在基金会中开放使用，又可以为开发此命令的公司所独有。

## 二、含义

**1、主机**（Master）：分为第一主机和第二主机，它能连接在 HART 网络上，发出命令与从机通讯。

**2、从机**（Field Device)：连接在过程控制现场中，具有测量、计算多种变量功能，并能与主机进行 HART 通讯的设备。

**3、长帧**（Long Frame）：地址Address 由5字节组成的 HART 数据帧，所有的 HART 命令都支持长帧数据帧。长帧地址各字节含义如下图所示：

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-345e37d7499493029af8009e687d7559_720w.jpg)

制造商ID号（Manufacturer ID）由 HART 基金会分配；

在生产中，通类型设备序列号唯一，并且永不重复。广播地址使用长帧结构，低38bit全为0。

厂商指定的设备类型（Decive Type）与制造商ID满足下表要求：

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-39d1ebb0527c0d30f80d5d52b630d374_720w.jpg)设备类型代码指定原则

**4、短帧**（Short Frame）：地址Address 由1字节组成的 HART 数据帧，短帧只有通用命令command 0 能够使用，短帧字节含义如下：所有的 HART 从机都支持长、短帧。

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-4f47405df5b3406a155a13d3e863d754_720w.jpg)短帧Address字节含义

**5、请求帧**（STX）：由主机（如手抄器）向从机（现场设备）发出请求数据命令。

**6、应答帧**（ACK）：从机回复给主机的数据。

**7、前导符**（Preamble）：发起命令（数据）传输的设备在传输数据帧前发送的0xFF字符，发送该字符的数量一般为5~20个，该数量可以通过命令来改变；前导符的使用是为了使数据接收端在硬件电路上产生CD载波检测信号，以实现数据通讯的同步。

**8、定界符**（Delimiter）：表示数据帧传输的开始，指明数据的传输方向、物理层类型，同时它也指定了数据帧的帧类型（长、短帧），其含义内容如下：

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-ce81cb9cb7eb96a3aff479c15da8781c_720w.jpg)定界符Delimiter字节含义

**9、地址**（Address）：由定界符Delimite指定为短帧（1字节）或长针（5字节）两种类型。

**10、扩展字节**（Expansion Bytes）：本公司目前的HART协议版本保留，为0.

**11、命令**（Command）：功能码，指明一个数据帧的具体实现功能，命令有通用命令、普通应用命令、设备专用命令三大类。

**12、数据字节数**（Bytes Count）：指实际的数据 Data 的数据。

**13、数据**（Data）：设置或读取指定从机的参数数据（通信的最终结果）。

**14、校验字节**（Check Byte）：从定界符到数据的所有字节的“异或”值，即纵向校验。

## 三、HART通讯规范

**1、通信帧格式**：由前导符和数据帧构成，各数据域释义如下：

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-42804ece553abab1eaba9af0721f4050_720w.jpg)通信帧格式

**2、通讯波特率**：1200Bps。

**3、通讯信号**：Bell202标准的FSK频移键控信号，“1200Hz”代表数字1，“2200Hz”代表数字0。

**4、数据格式**（11位）：1位起始位、8位数据位、1位校验位，字节奇校验。

**5、应答数据帧的数据个数**（Bytes Count）至少为2字节，这两个字节分别为响应码（Response Code）和设备状态码（Field Device Status）。

**6、响应码格式**：从机回复给主机的命令执行情况代码，当通讯出错时，响应码最高位bit7=1，这时设备状态码无实际意义；当bit7=0时，表示通讯正常，余下6bits表示命令执行情况的响应。

**7、通讯正常时响应码**（bit7=0，低6bits）：

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-826f7019dda198b31d060e466ef495f3_720w.jpg)

**8、通讯出错时响应代码**（bit7=1）含义如下：

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-37ad369f0e000527a0f16c0ee8c728fe_720w.jpg)

**9、设备状态码**：含义如下

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-3a9dc87705cf42ed62e06fcbf858b6a9_720w.jpg)

**10、数据类型**：HART通讯协议支持以下类型的数据：字符串Str、日期Date、单或双精度浮点数Float、无符号整型数Unsigned、有符号整型数Signed、联合体Enum或位Bit。数据传输顺序：MSB至LSB。

1）字符串：字符串支持标准的拉丁字母Latin和封装格式Packed的ASCII码，拉丁字符每个字母占1个字节；封装格式的ASCII码每字母占1个字节的6位，因此，每4个字母封装在3个字节中，在使用过程中需要打包和解包操作。

2）浮点数：满足IEEE754标准要求，单精度浮点数用4个字节表示，双精度浮点数用8个字节表示。

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-961df708672caacc904dce9c44267d35_720w.jpg)

不可识别的浮点数用0x7f、0xa0、0x00、0x00表示。

11、设备变量状态（Device Variable Status）：所有需要周期处理的数据（如设备变量和动态变量）都包含一个设备变量状态字节，其内容定义如下：默认0xc0

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-127e7b795da4119a5a361dbcb6505596_720w.jpg)设备变量状态字节含义

## 四、HART应用命令

命令有通用命令、普通应用命令、特殊命令三大类，通用命令是所有的HART现场设备都必须响应的命令；普通应用命令只被设备部分应用；专用命令是生产商根据需要制定的命令。

HART协议的各种命令统一由HART数据帧中的命令字节进行二进制编制，也就是说，HART协议最多可提供256种不同的命令。

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-987092f72e69a52490e373e80960e55e_720w.jpg)

**1、命令分类及其描述**

- **1** 用于获取基本变量的只读命令
- **1A** 用于获取基本变量的量程百分比及电流的只读命令
- **2** 从所有设备中获取通用信息的只读命令
- **3** 用于获取各个设备的专有信息的只读命令，可访问设备中的所有信息
- **4** 向每个设备发送一般操作所需信息的只写命令
- **5** 向每个设备发送初始设置所需信息的只写命令，其他不属于以上类别的读写功能，这些命令将不能被另一厂家的主机处理

**2、一致性分类命令仅包括通用命令和普通应用命令**

类别1 （通用命令）

- 0 读设备识别码
- 1 读基本变量

类别1A （通用命令）

- 0 读识别码
- 1 读设备基本变量量程百分比及电流

类别2 （通用命令）

- 4（0100） 保留位
- 11（1011） 读与位号（Tag）有关的标识符
- 12（1100） 读与设备有关的信息

**3、变送器命令有通用、普通、变送器专用三类**

变送器命令分配如下：

- command 0 通用命令
- command 30 通用命令
- command 31 保留
- command 32 普通应用命令
- command 127 保留
- command 128 变送器专用命令
- command 253 变送器专用命令
- command 254 保留
- command 255 保留

**4、响应码**

响应码的第一个字节的第7位如果置位，则剩余的位包含了有关通信错误的信息；第一个字节的第7位如果复位，则剩余的位用来表示命令响应信息。

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-4015f04a8d923beb300ef5750a65d2c2_720w.jpg)

- Bit 7=1时，其余位表示接收时的错误信息：
- Bit 6 垂直奇偶校验错误
- Bit 5 覆盖错误
- Bit 4 帧错误
- Bit 3 纵向奇偶校验错误
- Bit 2 保留，应清零
- Bit 1 缓冲区溢出
- Bit 0 未定义
- Bit 7=0时，则该字节包含有关命令执行情况的信息

其余Bit 6~Bit 0编码，范围无符号整数0~127，如：

- 响应码#32 忙 （0010 0000）
- 响应码#64 命令不支持

响应码的第二个字节为与设备的操作状态有关的信息，如在第一个字节中报告有错误，则该字节无意义。

![img](C:\Users\putao\Documents\Blog\Untitled.assets\v2-671e9f5f4ae709887dcb1a23375e2d6b_720w.jpg)

该字节中各位的意义如下：

- Bit 7 现场设备工作不正常
- Bit 6 组态变化：写或设置命令被执行
- Bit 5 冷启动：由于设置信息的重安装
- Bit 4 有更多的状态信息可用
- Bit 3 基本变量的模拟输出被固定
- Bit 2 基本变量的模拟输出已饱和
- Bit 1 非基本变量超限
- Bit 0 基本变量超限

## 五、HART应用

由于HART仪表与原4-20mA标准的仪表具有兼容性，HART仪表的开发与应用发展迅速，特别是在设备改造中受到欢迎。

HART通信的应用通常有三种方式：

1、最普通的是用手持通信终端（HHT）与现场智能仪表通信。

2、带HART通信功能的控制室仪表，可与多台HART仪表进行通信并组态。

3、第三种方式是与PC机或DCS操作站进行通信。